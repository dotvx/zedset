# Paste via Hammerspoon HTTP server (port 8888)

## ⚠️ CRITICAL: Use `--data-binary` for Multi-line Text

**ALWAYS use `--data-binary @-`** when sending multi-line text to preserve newlines!

```bash
# ✅ CORRECT - preserves newlines
curl -X POST --data-binary @- http://localhost:8888/paste

# ❌ WRONG - strips newlines (converts to single line)
curl -X POST -d @- http://localhost:8888/paste
```

## Usage Examples

### Basic usage - paste text to active window
```bash
# Single line text (both work)
curl -X POST http://localhost:8888/paste -d "text to paste"
curl -X POST http://localhost:8888/paste --data-binary "text to paste"
```

### Paste with variable
```bash
TEXT="your content here"
curl -X POST http://localhost:8888/paste -d "$TEXT"
```

### Paste from file (MUST use --data-binary for multi-line files)
```bash
# ✅ CORRECT - preserves newlines in file
curl -X POST --data-binary @/path/to/file.txt http://localhost:8888/paste

# ❌ WRONG - converts file to single line
curl -X POST -d @/path/to/file.txt http://localhost:8888/paste
```

### Paste from stdin/pipe (MUST use --data-binary)
```bash
# ✅ CORRECT - preserves newlines
echo -e "line1\nline2\nline3" | curl -X POST --data-binary @- http://localhost:8888/paste

# ❌ WRONG - strips newlines
pbpaste | curl -X POST -d @- http://localhost:8888/paste
```

### Paste from clipboard
```bash
pbpaste | curl -X POST --data-binary @- http://localhost:8888/paste
```

### Paste multiline text
```bash
# Method 1: heredoc (recommended)
curl -X POST --data-binary @- http://localhost:8888/paste <<'EOF'
line 1
line 2
line 3
EOF

# Method 2: printf (preserves exact formatting)
printf '%s\n' "line 1" "line 2" "line 3" | curl -X POST --data-binary @- http://localhost:8888/paste
```

## How It Works

1. **Receives text** via HTTP POST to `/paste` endpoint
2. **Writes to clipboard** using `hs.pasteboard.writeAllData()` with UTF-8 encoding
3. **Simulates Cmd+V** via `hs.eventtap.keyStroke()` to paste into active window
4. **Returns "OK"** on success (HTTP 200)

## Why `--data-binary` is Required

- `-d` / `--data`: URL-encodes data and **strips newlines** (`\n` removed)
- `--data-binary`: Sends raw bytes **preserving all characters including newlines**

For any text processing scripts that work with multiple lines, **always use `--data-binary @-`**!

## Testing

```bash
# Test newline preservation
printf 'line1\nline2\nline3\n' | curl -X POST --data-binary @- http://localhost:8888/paste -s
pbpaste  # Should show 3 lines, not 1

# Verify with hex dump
pbpaste | od -c | grep "\\n"  # Should see \n characters
```

## Server Implementation

Location: `/Users/risenowrise/v/karabiner/init.lua`

```lua
-- POST /paste endpoint handler
hs.pasteboard.clearContents()
hs.pasteboard.writeAllData({["public.utf8-plain-text"] = body})
hs.eventtap.keyStroke({"cmd"}, "v")
```
